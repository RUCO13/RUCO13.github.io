<!DOCTYPE html>
<html lang="en-us">
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-NE33R61XSF"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-NE33R61XSF');
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="author" content="Oscar Ruiz Cigarrillo">
  <title>Oscar's web page</title>
  <link rel="icon" href="data/images/logo.png" type="image/icon type">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.4/css/academicons.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Zilla+Slab:wght@400;500;600&family=Montserrat:wght@400;700;900&family=Roboto:wght@400;700&family=Playfair+Display&display=swap" rel="stylesheet">

  <!-- MathJax config BEFORE loading MathJax -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [['\\[', '\\]']]
      },
      svg: { fontCache: 'global' }
    };
  </script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Roboto', sans-serif;
      font-size: 1rem;
      background: linear-gradient(135deg, #353740 0%, #2a2d3a 50%, #1f2129 100%);
      color: #f8f9fc;
      line-height: 1.6;
      scrollbar-width: thin;
    }

    /* Global image safety: prevents overflow in any section */
    img, svg, video, canvas {
      max-width: 100%;
      height: auto;
    }

    ::-webkit-scrollbar { width: 7px; }
    ::-webkit-scrollbar-thumb { background-color: #6e6e80; border-radius: 3px; }
    ::-webkit-scrollbar-track { background-color: #353740; }

    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: rgba(53, 55, 64, 0.9);
      backdrop-filter: blur(10px);
      z-index: 1000;
      padding: 1rem 0;
      border-bottom: 1px solid rgba(4, 244, 232, 0.2);
    }

    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 0 2rem;
    }

    .nav-links {
      display: flex;
      gap: 2rem;
      list-style: none;
    }

    .nav-link {
      color: #94a3b8;
      text-decoration: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .nav-link:hover,
    .nav-link.active {
      color: #04f4e8;
      background: rgba(4, 244, 232, 0.1);
    }

    .mobile-toggle {
      display: none;
      background: none;
      border: none;
      color: #04f4e8;
      font-size: 1.5rem;
      cursor: pointer;
      position: absolute;
      left: 1rem;
    }

    .main-container {
      margin-top: 80px;
      min-height: calc(100vh - 80px);
    }

    .section {
      display: none;
      min-height: calc(100vh - 80px);
      padding: 0; /* IMPORTANT: no padding here, we control padding with .section-content */
    }
    .section.active { display: block; }

    /* IMPORTANT FIX:
       - Remove the global max-width constraint from the wrapper that hosts home.html
       - Let each section define its own width logic.
    */
    .section-content {
      width: 100%;
      max-width: none;     /* ✅ key fix */
      margin: 0;           /* ✅ key fix */
      padding: 0;          /* ✅ key fix */
    }

    /* Loading UI */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 50vh;
      flex-direction: column;
      gap: 1rem;
      padding: 2rem;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(4, 244, 232, 0.3);
      border-top: 3px solid #04f4e8;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-text { color: #94a3b8; font-size: 0.9rem; }

    /* Mobile nav */
    @media screen and (max-width: 768px) {
      .nav-container { justify-content: flex-end; }

      .nav-links {
        position: fixed;
        top: 80px;
        left: -100%;
        width: 100%;
        height: calc(100vh - 80px);
        background: rgba(53, 55, 64, 0.95);
        flex-direction: column;
        align-items: center;
        padding-top: 2rem;
        gap: 1rem;
        transition: left 0.3s ease;
      }

      .nav-links.active { left: 0; }

      .nav-link {
        font-size: 1.2rem;
        padding: 1rem 2rem;
        width: 80%;
        text-align: center;
      }

      .mobile-toggle { display: block; }
    }

    @media screen and (max-width: 480px) {
      .nav-container { padding: 0 1rem; }
    }
  </style>
</head>

<body>
  <nav class="navbar">
    <div class="nav-container">
      <button class="mobile-toggle" id="mobileToggle" aria-label="Toggle menu">
        <i class="fas fa-bars"></i>
      </button>

      <ul class="nav-links" id="navLinks">
        <li><a href="#home" class="nav-link active" data-section="home">Home</a></li>
        <li><a href="#research" class="nav-link" data-section="research">Research</a></li>
        <li><a href="#posts" class="nav-link" data-section="posts">Posts</a></li>
        <li><a href="#code" class="nav-link" data-section="code">Code</a></li>
        <li><a href="#teaching" class="nav-link" data-section="teaching">Teaching</a></li>
        <li><a href="#acknowledges" class="nav-link" data-section="acknowledges">Acknowledges</a></li>
      </ul>
    </div>
  </nav>

  <div class="main-container">
    <!-- Home Section -->
    <section class="section active" id="home">
      <div class="section-content">
        <div class="loading">
          <div class="spinner"></div>
          <div class="loading-text">Loading Home...</div>
        </div>
      </div>
    </section>

    <!-- Research Section -->
    <section class="section" id="research">
      <div class="section-content">
        <div class="loading">
          <div class="spinner"></div>
          <div class="loading-text">Loading Research...</div>
        </div>
      </div>
    </section>

    <!-- Posts Section -->
    <section class="section" id="posts">
      <div class="section-content">
        <div class="loading">
          <div class="spinner"></div>
          <div class="loading-text">Loading Posts...</div>
        </div>
      </div>
    </section>

    <!-- Code Section -->
    <section class="section" id="code">
      <div class="section-content">
        <div class="loading">
          <div class="spinner"></div>
          <div class="loading-text">Loading Code...</div>
        </div>
      </div>
    </section>

    <!-- Teaching Section -->
    <section class="section" id="teaching">
      <div class="section-content">
        <div class="loading">
          <div class="spinner"></div>
          <div class="loading-text">Loading Teaching...</div>
        </div>
      </div>
    </section>

    <!-- Acknowledges Section -->
    <section class="section" id="acknowledges">
      <div class="section-content">
        <div class="loading">
          <div class="spinner"></div>
          <div class="loading-text">Loading Acknowledges...</div>
        </div>
      </div>
    </section>
  </div>

  <script>
    // Lazy section loader
    const loadedSections = new Set();

    const sectionPaths = {
      home: './sections/home.html',
      research: './sections/research.html',
      posts: './sections/posts.html',
      code: './sections/software.html',
      teaching: './sections/teaching.html',
      acknowledges: './sections/acknowledges.html'
    };

    function retargetScripts(container) {
      const scripts = container.querySelectorAll('script');
      scripts.forEach(oldScript => {
        const newScript = document.createElement('script');
        if (oldScript.src) {
          newScript.src = oldScript.src;
          newScript.async = oldScript.async;
          newScript.defer = oldScript.defer;
        } else {
          newScript.textContent = oldScript.textContent;
        }
        oldScript.replaceWith(newScript);
      });
    }

    async function loadSection(sectionId) {
      if (loadedSections.has(sectionId) || !sectionPaths[sectionId]) return;

      const sectionElement = document.getElementById(sectionId);
      const contentDiv = sectionElement.querySelector('.section-content');

      try {
        const response = await fetch(sectionPaths[sectionId], { cache: "no-store" });
        if (!response.ok) throw new Error(`HTTP ${response.status}`);

        const html = await response.text();

        // Put section HTML directly into container
        contentDiv.innerHTML = html;

        // IMPORTANT:
        // If your section file contains <style> tags, keep them, but avoid duplicates:
        const styles = contentDiv.querySelectorAll('style');
        styles.forEach(styleTag => {
          const key = `section-style-${sectionId}`;
          if (!document.getElementById(key)) {
            const s = document.createElement('style');
            s.id = key;
            s.textContent = styleTag.textContent;
            document.head.appendChild(s);
          }
          styleTag.remove(); // remove inline style from body to keep DOM clean
        });

        // Re-execute scripts inside section
        retargetScripts(contentDiv);

        loadedSections.add(sectionId);
        console.log(`✅ Loaded section: ${sectionId}`);

        // Re-typeset MathJax after injection
        if (window.MathJax && window.MathJax.typesetPromise) {
          window.MathJax.typesetPromise().catch(err => console.log('MathJax error:', err));
        }
      } catch (error) {
        console.warn(`⚠️ Could not load section ${sectionId}:`, error);
        contentDiv.innerHTML = `
          <div style="text-align:center; padding:4rem; color:#94a3b8;">
            <h2>Coming Soon</h2>
            <p>This section is under development.</p>
          </div>
        `;
      }
    }

    function setActiveLink(sectionId) {
      document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
      const link = document.querySelector(`[data-section="${sectionId}"]`);
      if (link) link.classList.add('active');
    }

    function showSection(sectionId, updateHash = true) {
      document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
      const targetSection = document.getElementById(sectionId);
      if (targetSection) targetSection.classList.add('active');

      setActiveLink(sectionId);

      if (!loadedSections.has(sectionId)) loadSection(sectionId);

      if (updateHash) history.replaceState(null, '', `#${sectionId}`);
    }

    function getSectionFromHash() {
      const h = (window.location.hash || '').replace('#', '').trim();
      return h && document.getElementById(h) ? h : 'home';
    }

    document.addEventListener('DOMContentLoaded', function() {
      const navLinks = document.querySelectorAll('.nav-link');
      const mobileToggle = document.getElementById('mobileToggle');
      const navLinksContainer = document.getElementById('navLinks');

      navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const sectionId = this.getAttribute('data-section');
          showSection(sectionId);

          // Close mobile menu
          navLinksContainer.classList.remove('active');
          const icon = mobileToggle.querySelector('i');
          icon.classList.remove('fa-times');
          icon.classList.add('fa-bars');
        });
      });

      mobileToggle.addEventListener('click', function() {
        navLinksContainer.classList.toggle('active');
        const icon = this.querySelector('i');
        if (navLinksContainer.classList.contains('active')) {
          icon.classList.remove('fa-bars');
          icon.classList.add('fa-times');
        } else {
          icon.classList.remove('fa-times');
          icon.classList.add('fa-bars');
        }
      });

      // Initial route
      const initial = getSectionFromHash();
      showSection(initial, false);

      // Hash changes
      window.addEventListener('hashchange', () => {
        const target = getSectionFromHash();
        showSection(target, false);
      });
    });
  </script>
</body>
</html>